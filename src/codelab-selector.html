<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="elements/codelab-card.html">

<dom-module id="codelab-selector">

  <template>

    <style include="iron-flex iron-flex-alignment">
      :host {
        display: block;
        padding: 10px;
      }
      codelab-card {
        margin: 10px;
        max-width: 350px;
      }
    </style>

    <div class="horizontal layout wrap">
      <template is="dom-repeat" items="[[codelabs]]">
        <codelab-card title="[[item.title]]" summary="[[item.summary]]" theme="[[item.theme]]"
                      difficulty="[[item.difficulty]]" duration="[[item.duration}}" tags="[[item.tags]]"
                      updated="[[item.updated]]" url="[[item.url]]"
                      themesmap="[[themesmap]]"></codelab-card>
      </template>

      <iron-ajax
        auto
        url="/api/codelabs.json"
        handle-as="json"
        on-response="_codelabsInfoHandler">
    </div>

  </template>

  <script>

    Polymer({

      is: 'codelab-selector',

        properties: {
          codelabs: {
            type: Array,
            value: function() {
              return [];
            }
          },
          themesmap: Object,
        },

        _codelabsInfoHandler: function(event) {
          this.themesmap = event.detail.response["themes"];
          event.detail.response["codelabs"].forEach(function(codelab) {
            this.push("codelabs", codelab);
          }, this);
          console.log(this.codelabs);
        }
    });

  </script>

</dom-module>
